# Огляд мікроконтролерів для початківців: з чого і як стартувати?

## Основні платформи, доступні на нашому ринку.

### Arduino

Сам я не працював з цим залізом, тому можу описати його хіба згідно прочитаного-почутого.

Плюси:
* широта і доступність екосистеми (зокрема, деякі плати STM32 були свого часу сертифіковані і розповсюджувались під маркою Arduino);
* низький поріг входження для малококваліфікованих новачків — набори-конструктори і керівництва, орієнтовані на непрофесіоналів (здається, саме Arduino було першопроходцем просування робототехніки в маси). 

Мінуси:
* багато хто нарікає на Arduino IDE — зокрема, рішати там якісь нетривіяльні проблеми може виявитись складніше, ніж деинде;
* якщо ж працювати з цим набором заліза через універсальні фреймворки, то він не видається чимось кращим і особливим на загальному тлі — хіба коштує місцями дорожче за инших, так що навряд чи є сенс розглядати його як елемент серйозних розробок (радше, як пишуть, "зручний радіоконструктор для швидкої розробки електронних пристроїв").

Інструменти розробки:
* Arduino IDE — від початку це була спеціялізована платформа, яка зараз дозволяє працювати і з ширшим набором заліза;
* Platformio — універсальний фреймворк, на якому можна працювати з усіма популярними апаратними платформами;
* є й инші інструменти (наче, менш популярні), не можу тут охарактеризувати аж всі.

Варто зауважити, що Arduino-проєкти порівняно не складно імпортуються в середовище Platformio, оскільки Platformio, серед иншого, підтримує бібліотеки з фреймворку Arduino. Отже, конвертації потребує тільки загальний файл опису проєкту: https://community.platformio.org/t/moving-from-arduino-ide-to-platformio-ide/42372


### ESP32

Плюси:
* дешевизна, широта і універсальність екосистеми;
* зокрема WiFi, Bluetooth — ці інтерфейси доступні "з коробки" навіть на найдешевших платах з ESP32;
* це вже платформа мікроконтролерів, орієнтована на фахове застосування, а не конструктор для початківців.

Мінуси:
* це Китай, що зупиняє деяких виробників у використанні цього (концепція "china-free" задля убезпечнення проєкту від ризиків китайського технологічного і економічного впливу);
* фахівці, буває, серйозно нарікають на рішення від ESP.

Інструменти розробки:
* Espressif IDE — спеціялізована платформа (Eclipse plugin, VS Code extension);
* Platformio — універсальний фреймворк (заявлено, що ESP припинило підтримку Platformio, але Platformio цілком справляється);
* Arduino IDE, инші універсальні фреймворки.

Платформа ESP32 включає в себе декілька різних типів процесорів, код між якими не переноситься безшовно (можливі дуже навіть болючі нюанси). Тому при початковому виборі конкретного процесора варто уважно вичитувати порівняльні таблиці.

В доступі є макетні плати на основі ESP32 від різних виробників, але їх якість не завжди однакова — при плануванні серійного виробництва це варто перевіряти наперед.


### STM32

Плюси:
* особлива широта і універсальність рішень — від геть дешевих до дуже і дуже серйозних (тільки на STM32F4 ми свого часу знайшли АЦП на 7.2 мегасемпли (3 * 2.4) за розумні гроші, хоч якість його роботи і виявилась далеко не найкращою);
* це европейський розробник.
  
Мінуси:
* фахівці вважають якість рішень від STM32 гіршою, ніж якість рішень від "дорожчих" виробників на кшталт NXP чи Texas Instruments (сам я мав нагоду порівняти якість роботи АЦП на STM32F4Discovery, де графік випадковим чином хитало на +-2% від максимального значення, і АЦП на иншому мікроконтролері, де графік був чистий і рівний);
* на платах від STM32 нема WiFi (принаймні, на тих, які виглядають доступно по ціні), ось, для прикладу, обговорення цього —
https://community.st.com/t5/stm32-mcus-wireless/stm32-and-wifi/m-p/606978#M16900 (фахівці кажуть, що для роботи з WiFi на STM32 найкраже буде приєднати туди копієчну плату ESP32, на якій є WiFi).

Інструменти розробки:
* STM32Cube — спеціялізована платформа (Eclipse);
* Eclipse з плагінами, які є в загальних Eclipse-репозиторіях;
* Platformio, Arduino IDE, инші універсальні фреймворки.

Варто мати на увазі, що код між дешевшими і дорожчими серіями процесорів STM32 переноситься не завжди просто. Наприклад, спеціялізована бібліотека CMSIS, на якій побудовано стандартні приклади для молодших серій STM32F, від початку не була доступна на старшій серії STM32H, там слід працювати з бібліотекою HAL; бачу якесь community-рішення — https://github.com/Open-CMSIS-Pack/STM32H7xx_DFP — але це точно не фірмовий стандарт.


### Paspberry Pi Pico

Сам я не працював з цим залізом, тому можу описати його хіба згідно прочитаного-почутого.

Плюси:
* вбудовані функції захисту;
* це европейський розробник.

Мінуси:
* вочевидь, ця платформа менш популярна на наших теренах, а це про щось та й свідчить.


### Инші платформи

На загал, вони дорожчі і, кажуть, більш якісні, ніж ESP32/STM32. Я, наприклад, чув добрі фахові відгуки про мікроконтролери NXP і Texas Instruments.


## Альтернатива??? Мікрокомпʼютери під Linux.

Для багатьох задач добрим рішенням буде не мікроконтролер, а мікрокомпʼютер типу Raspberry Pi чи Orange Pi — на них, стандартно, є набір пінів GPIO, до яких можна приєднувати таку ж периферію, як і до мікроконтролерів. 

Плюси:
* стандартне операційне середовище — Linux — звільняє від багатьох проблем :-)
* як правило, основні компʼютерні інтерфейси доступні "з коробки" — WiFi, Bluetooth, LAN, USB, UART, SD, порт для монітора;
* ресурси памʼяти і швидкодія, як правило, істотно вищі, ніж на мікроконтролерах; в якості верхньої межі розглядаю STM32H743 — 400 МГц (є ще STM32 N-серія на 800 МГц, але взагалі не бачу, як їх купити в Україні), в той же час найпростіша Raspberry Pi Zero стартує з 1 ГГц.

Мінуси:
* стандартне операційне середовище — Linux — це не real-time, тому рішення дуже високочастотних задач може виявитись істотно складнішим, ніж на мікроконтролері;
* багато елементів, стандартних для девбордів — PWM, ADC, DAC, SPI, I2C — бувають відсутні на мікрокомпʼютерах (але їх можна додавати через GPIO і, зрештою, є моделі, де вони й знайдуться);
* ціна дещо вища, ніж на мікроконтролери.

Інструментарій:
* стандартні десктопні IDE (VS Code, IntelliJ тощо) і тулчейни (C/C++, Rust, Golang, Python чи будь-що инше, аби там були бібліотеки для необхідних апаратних інтерфейсів — GPIO тощо).

Важливо! Якщо на Raspberry Pi настроїти SSH доступ і вхід по WiFi у свою мережу (це можна зробити ще до першого запуску, конфігуруючи оперсистему перед її записом на SD-картку), то можна працювати з нею по SSH, приєднавши лиш живлення. Якщо ж приєднати монітор-клавіятуру-мишку — це буде звичайний Linux-компʼютер. В обох випадках програми для Raspberry Pi білдяться на самому Raspberry Pi і можуть бути там відладжені в звичному консольному режимі (або й з дебагером) — це зручніше, ніж білдити програми для мікроконтролерів на десктопі, завантажувати їх на мікроконтролер, а потім рішати проблеми з відладкою (для цього часом потрібно піднімати непрості дебаг-інструменти).


## Порівняння цін

### ESP32C3 — 130 грн. — https://cheapest.com.ua/p2066353956-esp32-devkit-bluetooth.html

Для програмування потрібна тільки плата і звичайний кабель USB Type-C. Ось приклад робочого проєкту під Platformio:
https://github.com/pavlo67/schola/tree/master/overviews/esp32_platformio_hello

В цьому проєкті:
* активується LED;
* йде вивід на консоль;
* активується точка доступу WiFi;
* на платі запускається http-сервер.

Щодо прикладів роботи з периферією, яку можна чіпляти на таку плату, то їх більш ніж достатньо в мережі і кожен, кого не забанив гугл, ютуб чи github, може ними скористатись. Ось, наприклад: https://arduino.ua/art260-rozymna-meteostanciya-na-bazi-esp32 (українською, саме на esp32c3 і platformio).


### STM32F103C8T6 (Blue Pill) — 99 грн. — https://myproject.com.ua/stm32f103c8t6-plata-rozrobnika-ua.html

Ця плата для програмування потребує ще програматора ST-Link — 99 грн. — https://myproject.com.ua/st-linkv2-programator-mini-dlja-stm8-ta-stm32-ua.html

Вона, однак, істотно уступає за параметрами наступні платі від STM, яка при цьому ненабагато дорожча. Також на Blue Pill boot-режим активується не кнопкою, а перемичкою — це доволі незручно.


### STM32F401RCT6 — 170 грн. — https://prom.ua/ua/p2215009586-maketnaya-plata-stm32f401rct6.html

Ця плата для програмування потребує програматора ST-Link — 99 грн. — https://myproject.com.ua/st-linkv2-programator-mini-dlja-stm8-ta-stm32-ua.html

За параметрами початкові моделі STM32 виглядають набагато слабшими, ніж ESP32C3.


### Raspberry Pi Zero v/1.3 512M — 665 грн. — https://evo.net.ua/raspberry-pi-zero

Це вже повноцінний компʼютер (якщо приєднати монітор, клавіятуру і мишку), на якому можна використовувати Linux.


### Raspberry Pi 4 1Gb — 2199 грн. — https://minicomp.com.ua/ua/raspberry-pi/raspberry-pi-4/raspberry-pi-4-model-b-1gb


### Raspberry Pi 4 4Gb — 3399 грн. — https://minicomp.com.ua/ua/raspberry-pi/raspberry-pi-4/raspberry-pi-4-model-b-4gb

Це вже повноцінний компʼютер (якщо приєднати монітор, клавіятуру і мишку), на якому можна використовувати Linux з X-Windows.

### Orange Pi

Лінійка китайських мікрокомпʼютерів, які, при рівних параметрах, помітно дешевші ніж Raspberry Pi, але й викликають більше нарікань (але при цьому досить популярні у нас — отже, це дійсно робочі рішення).


## Community-проєкти

Для розуміння, як використовувати різні можливости мікроконтролерів, можна подивитись у відомі Community-проєкти

* ExpressLRS (ELRS) - побудований на Platformio (VS Code or IntelliJ);
* Ardupilot - з ним можна використовувати, наприклад, Eclipse чи VS Code;
* Betaflight - з ним можна використовувати, наприклад, Eclipse чи VS Code (але у мене VS Code зі старту не захотів підтягувати інклюди, тому я для Betaflight користуюсь Eclipse).

Універсальні проєкти, звісно, ой які непрості :-(


